<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMIRUL MATH CARE - Ultimate Pro Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f0f4f8; transition: 0.3s; color: #1e293b; }
        .dark-mode { background-color: #0f172a; color: #f1f5f9; }
        .dark-mode .bg-white { background-color: #1e293b; color: white; }
        .brand-purple { background-color: #4c1d95; }
        .hidden { display: none; }
        
        /* Slider & Animations */
        .slider-container { position: relative; width: 100%; height: 350px; overflow: hidden; border-radius: 24px; }
        .slider-track { display: flex; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); height: 100%; }
        .slide { min-width: 100%; height: 100%; position: relative; }
        .slide img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        
        /* Exam & UI Elements */
        .option-card { cursor: pointer; transition: 0.2s; border: 2px solid #e2e8f0; }
        .option-card:hover { border-color: #4c1d95; background-color: #f5f3ff; }
        .selected-option { border-color: #4c1d95 !important; background-color: #ede9fe !important; font-weight: bold; }
        
        @media print { .no-print { display: none !important; } #displayArea { display: block !important; } }
        
        .tab-active { border-bottom: 4px solid #fbbf24; color: #fbbf24; }
    </style>
</head>
<body id="body">

    <div class="bg-indigo-900 text-white py-2 no-print">
        <div class="container mx-auto px-4 flex items-center">
            <span class="bg-yellow-500 text-black text-[10px] font-black px-2 py-1 rounded mr-3 animate-pulse uppercase">Notice</span>
            <marquee id="mainNotice" class="text-sm font-semibold">আমিরুল ম্যাথ কেয়ারে অনলাইন পরীক্ষা ও ডিজিটাল প্রোফাইল সিস্টেম চালু হয়েছে।</marquee>
        </div>
    </div>

    <nav class="brand-purple p-4 text-white sticky top-0 z-50 shadow-2xl no-print">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <img id="navLogo" src="https://i.ibb.co/Lhy0W0P/1000018420.jpg" class="w-10 h-10 rounded-full border-2 border-white object-cover">
                <h1 class="text-lg md:text-xl font-black tracking-tighter uppercase">AMIRUL MATH CARE</h1>
            </div>
            <div class="flex gap-4 items-center text-sm">
                <button onclick="toggleDarkMode()" class="p-2"><i class="fas fa-moon"></i></button>
                <div class="hidden md:flex gap-4 font-bold">
                    <a href="#" onclick="showSection('studentView')">হোম</a>
                    <a href="#" onclick="showSection('onlineExamPortal')">অনলাইন পরীক্ষা</a>
                    <a href="#" onclick="showSection('studentProfile')">প্রোফাইল</a>
                </div>
                <button id="adminLoginBtn" onclick="showSection('loginSection')" class="bg-yellow-400 text-purple-900 px-4 py-1 rounded-full font-bold transition hover:scale-105">অ্যাডমিন</button>
                <button id="logoutBtn" onclick="logout()" class="hidden bg-red-500 px-4 py-1 rounded-full font-bold">লগ আউট</button>
            </div>
        </div>
    </nav>

    <div id="studentView" class="container mx-auto mt-6 p-4 no-print">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="space-y-6">
                <div class="bg-white p-8 rounded-3xl shadow-xl border-t-8 border-purple-800">
                    <h3 class="font-bold text-gray-800 text-xl mb-4"><i class="fas fa-poll-h mr-2 text-purple-700"></i> রেজাল্ট ও প্রোফাইল</h3>
                    <div class="space-y-3">
                        <select id="searchClass" class="w-full p-3 border rounded-xl bg-gray-50">
                            <option value="">শ্রেণী নির্বাচন করুন</option>
                            <option>৬ষ্ঠ</option><option>৭ম</option><option>৮ম</option><option>৯ম</option><option>১০ম</option><option>SSC</option>
                        </select>
                        <input type="text" id="searchRoll" placeholder="রোল নম্বর" class="w-full p-3 border rounded-xl bg-gray-50">
                        <input type="date" id="searchDate" class="w-full p-3 border rounded-xl bg-gray-50 text-xs">
                        <button onclick="checkResult()" class="w-full brand-purple text-white py-3 rounded-xl font-bold shadow-lg hover:opacity-90">রেজাল্ট দেখুন</button>
                        <button onclick="enterStudentProfile()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:opacity-90">আমার প্রোফাইল</button>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-orange-400 to-red-600 p-6 rounded-3xl text-white shadow-xl">
                    <h2 class="text-xl font-black mb-2">অনলাইন পরীক্ষা</h2>
                    <p class="text-xs opacity-90 mb-4">বাড়িতে বসেই তোমার মেধা যাচাই করো।</p>
                    <button onclick="showSection('onlineExamPortal')" class="bg-white text-orange-600 px-6 py-2 rounded-full font-black text-sm uppercase">স্টার্ট পরীক্ষা</button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div id="heroSlider" class="slider-container mb-6 shadow-2xl">
                    <div id="sliderTrack" class="slider-track"></div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-2xl text-center shadow hover:border-purple-500 border-2 border-transparent transition cursor-pointer">
                        <i class="fas fa-book-reader text-2xl text-purple-600"></i>
                        <p class="text-xs font-bold mt-2">লেকচার নোট</p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl text-center shadow hover:border-blue-500 border-2 border-transparent transition cursor-pointer">
                        <i class="fas fa-video text-2xl text-blue-600"></i>
                        <p class="text-xs font-bold mt-2">টিউটোরিয়াল</p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl text-center shadow hover:border-green-500 border-2 border-transparent transition cursor-pointer">
                        <i class="fas fa-calendar-alt text-2xl text-green-600"></i>
                        <p class="text-xs font-bold mt-2">রুটিন</p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl text-center shadow hover:border-red-500 border-2 border-transparent transition cursor-pointer">
                        <i class="fas fa-headset text-2xl text-red-600"></i>
                        <p class="text-xs font-bold mt-2">সাপোর্ট</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="studentProfile" class="container mx-auto mt-6 p-4 hidden no-print">
        <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="brand-purple p-8 text-white flex flex-col items-center">
                <div class="relative group">
                    <img id="userAvatar" src="https://ui-avatars.com/api/?background=random" class="w-24 h-24 rounded-full border-4 border-white shadow-xl object-cover">
                    <label class="absolute bottom-0 right-0 bg-yellow-400 text-black p-2 rounded-full cursor-pointer text-xs"><i class="fas fa-camera"></i><input type="file" id="avatarInput" class="hidden"></label>
                </div>
                <h2 id="profName" class="text-2xl font-black mt-4">নাম লোড হচ্ছে...</h2>
                <p id="profClassRoll" class="opacity-80">শ্রেণী ও রোল লোড হচ্ছে...</p>
            </div>
            <div class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-purple-50 p-4 rounded-2xl text-center border">
                    <p class="text-xs text-purple-500 font-bold uppercase">গড় নম্বর</p>
                    <h3 id="avgScore" class="text-2xl font-black text-purple-800">০%</h3>
                </div>
                <div class="bg-green-50 p-4 rounded-2xl text-center border">
                    <p class="text-xs text-green-500 font-bold uppercase">পেমেন্ট স্ট্যাটাস</p>
                    <h3 class="text-2xl font-black text-green-800">OK</h3>
                </div>
                <div class="bg-orange-50 p-4 rounded-2xl text-center border">
                    <p class="text-xs text-orange-500 font-bold uppercase">মোট পরীক্ষা</p>
                    <h3 id="totalExams" class="text-2xl font-black text-orange-800">০</h3>
                </div>
                <div class="md:col-span-3">
                    <h4 class="font-bold text-gray-800 mb-4 border-b pb-2">সর্বশেষ পরীক্ষার ইতিহাস</h4>
                    <div id="profileResultList" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="onlineExamPortal" class="container mx-auto mt-6 p-4 hidden no-print">
        <div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div id="examStartView" class="p-10 text-center">
                <i class="fas fa-brain text-5xl text-purple-600 mb-4"></i>
                <h2 class="text-2xl font-bold mb-6">অনলাইন কুইজ পোর্টাল</h2>
                <div class="space-y-4">
                    <input type="text" id="exStudentName" placeholder="তোমার নাম" class="w-full p-4 border rounded-xl bg-gray-50">
                    <select id="exSubject" class="w-full p-4 border rounded-xl bg-gray-50">
                        <option value="গণিত">সাধারণ গণিত</option>
                        <option value="উচ্চতর গণিত">উচ্চতর গণিত</option>
                    </select>
                    <button onclick="startExamNow()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black shadow-xl hover:bg-green-700">পরীক্ষা শুরু করো</button>
                </div>
            </div>
            <div id="examLiveView" class="p-8 hidden">
                <div class="flex justify-between items-center mb-6 bg-yellow-100 p-4 rounded-xl font-bold">
                    <span id="examTimer" class="text-red-600"><i class="fas fa-clock mr-2"></i>১০:০০</span>
                    <span class="text-purple-800">প্রশ্ন: <span id="qIndex">১/১০</span></span>
                </div>
                <div id="questionContent" class="space-y-6"></div>
                <button onclick="submitOnlineExam()" class="w-full mt-8 brand-purple text-white py-4 rounded-xl font-black shadow-xl">পরীক্ষা জমা দাও</button>
            </div>
        </div>
    </div>

    <div id="loginSection" class="container mx-auto mt-12 p-6 max-w-md hidden no-print">
        <div class="bg-white p-10 rounded-2xl shadow-2xl text-center border-t-4 border-purple-700">
            <h2 class="text-2xl font-bold mb-6">অ্যাডমিন লগইন</h2>
            <input type="password" id="adminPass" placeholder="পাসওয়ার্ড" class="w-full p-4 border rounded-xl mb-6 text-center text-xl outline-none">
            <button onclick="adminLogin()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold">লগইন</button>
        </div>
    </div>

    <div id="adminPanel" class="container mx-auto mt-6 p-4 hidden no-print">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-md border-b-4 border-blue-500">
                <p class="text-xs text-gray-500 font-bold uppercase">মোট শিক্ষার্থী</p>
                <h3 id="statTotalStudent" class="text-2xl font-black text-blue-600">0</h3>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-md border-b-4 border-green-500">
                <p class="text-xs text-gray-500 font-bold uppercase">উপস্থিতি</p>
                <h3 id="statTodayAtt" class="text-2xl font-black text-green-600">0</h3>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-md border-b-4 border-purple-500">
                <p class="text-xs text-gray-500 font-bold uppercase">রেজাল্ট সংখ্যা</p>
                <h3 id="statTotalResult" class="text-2xl font-black text-purple-600">0</h3>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-md border-b-4 border-orange-500">
                <p class="text-xs text-gray-500 font-bold uppercase">আজকের পরীক্ষা</p>
                <h3 id="statOnlineCount" class="text-2xl font-black text-orange-600">0</h3>
            </div>
        </div>

        <div class="flex gap-4 mb-6 border-b overflow-x-auto no-scrollbar whitespace-nowrap">
            <button onclick="switchAdminTab('resultTab')" id="btn-resultTab" class="tab-active py-2 px-4 font-bold">রেজাল্ট এন্ট্রি</button>
            <button onclick="switchAdminTab('studentTab')" id="btn-studentTab" class="py-2 px-4 font-bold text-gray-500">শিক্ষার্থী ডাটাবেজ</button>
            <button onclick="switchAdminTab('questionTab')" id="btn-questionTab" class="py-2 px-4 font-bold text-gray-500">অনলাইন প্রশ্ন</button>
            <button onclick="switchAdminTab('noticeTab')" id="btn-noticeTab" class="py-2 px-4 font-bold text-gray-500">নোটিশ ও রুটিন</button>
        </div>

        <div id="resultTab" class="admin-tab-content space-y-6">
            <div class="bg-white p-8 rounded-2xl shadow-lg border-l-8 border-purple-600">
                <h2 class="text-xl font-bold mb-6 text-purple-900">অফলাইন রেজাল্ট এন্ট্রি (MCQ + CQ)</h2>
                <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
                    <div><label class="text-xs font-bold">তারিখ</label><input type="date" id="examDate" class="w-full p-2 border rounded-lg bg-gray-50"></div>
                    <div><label class="text-xs font-bold">শ্রেণী</label><select id="stdClass" onchange="fetchStudentInfo(); updateSubjectInputs();" class="w-full p-2 border rounded-lg font-bold"><option value="">সিলেক্ট</option><option>৬ষ্ঠ</option><option>৭ম</option><option>৮ম</option><option>৯ম</option><option>১০ম</option><option>SSC</option></select></div>
                    <div><label class="text-xs font-bold">রোল</label><input type="number" id="stdRoll" oninput="fetchStudentInfo()" class="w-full p-2 border-2 border-indigo-200 rounded-lg outline-none"></div>
                    <div class="col-span-2"><label class="text-xs font-bold">নাম</label><input type="text" id="stdName" class="w-full p-2 border rounded-lg bg-gray-100" readonly></div>
                </div>
                <div id="subjectInputs" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-purple-50 p-6 rounded-2xl mb-6"></div>
                <button onclick="saveResultData()" class="brand-purple text-white px-8 py-3 rounded-xl font-bold shadow-xl">রেজাল্ট সেভ করুন</button>
            </div>
        </div>

        <div id="studentTab" class="admin-tab-content hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl">
                <h2 class="font-bold text-xl mb-4">নতুন শিক্ষার্থী যুক্ত করুন</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="number" id="newRoll" placeholder="রোল" class="p-2 border rounded-xl">
                    <input type="text" id="newName" placeholder="নাম" class="p-2 border rounded-xl">
                    <select id="newClass" class="p-2 border rounded-xl"><option>৬ষ্ঠ</option><option>৭ম</option><option>৮ম</option><option>৯ম</option><option>১০ম</option><option>SSC</option></select>
                    <input type="text" id="newWa" placeholder="হোয়াটসঅ্যাপ (8801...)" class="p-2 border rounded-xl">
                    <button onclick="addStudentToDB()" class="md:col-span-4 bg-green-600 text-white font-bold py-2 rounded-xl">সেভ করুন</button>
                </div>
                <div id="dbList" class="mt-6 max-h-80 overflow-y-auto divide-y"></div>
            </div>
        </div>

        <div id="questionTab" class="admin-tab-content hidden space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl border-t-8 border-orange-500">
                <h2 class="font-bold text-xl mb-4">অনলাইন MCQ প্রশ্ন যোগ করুন</h2>
                <div class="space-y-4">
                    <input type="text" id="qTitle" placeholder="প্রশ্নটি লিখুন" class="w-full p-3 border rounded-xl">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="optA" placeholder="অপশন A" class="p-2 border rounded-xl">
                        <input type="text" id="optB" placeholder="অপশন B" class="p-2 border rounded-xl">
                        <input type="text" id="optC" placeholder="অপশন C" class="p-2 border rounded-xl">
                        <input type="text" id="optD" placeholder="অপশন D" class="p-2 border rounded-xl">
                    </div>
                    <select id="correctOpt" class="w-full p-3 border rounded-xl font-bold bg-green-50">
                        <option value="a">সঠিক উত্তর: A</option><option value="b">সঠিক উত্তর: B</option><option value="c">সঠিক উত্তর: C</option><option value="d">সঠিক উত্তর: D</option>
                    </select>
                    <button onclick="saveQuestionToFB()" class="bg-orange-600 text-white px-8 py-3 rounded-xl font-bold shadow-xl">প্রশ্নটি ডাটাবেজে পাঠান</button>
                </div>
                <div id="adminQuestionList" class="mt-8 space-y-3"></div>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-3xl shadow-xl overflow-hidden border">
            <div class="p-4 brand-purple text-white flex justify-between items-center">
                <h3 class="font-bold">রেজাল্ট ডাটাবেজ</h3>
                <div class="flex gap-2">
                    <input type="date" id="filterDate" onchange="renderResultTable()" class="text-black text-xs p-1 rounded">
                    <button onclick="downloadMeritPDF()" class="bg-yellow-500 text-black px-3 py-1 rounded text-xs font-bold">মেধা তালিকা PDF</button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-100 border-b">
                        <tr><th class="p-4">রোল</th><th class="p-4">নাম</th><th class="p-4">শ্রেণী</th><th class="p-4">মোট নম্বর</th><th class="p-4">মেরিট</th><th class="p-4">অ্যাকশন</th></tr>
                    </thead>
                    <tbody id="dataTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="displayArea" class="container mx-auto p-4 hidden flex flex-col items-center">
        <div id="pdfContent" class="bg-white p-8 rounded-lg shadow-xl border w-full max-w-md"></div>
        <div class="mt-6 flex gap-4 no-print">
            <button onclick="window.print()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold"><i class="fas fa-print mr-2"></i>প্রিন্ট করুন</button>
            <button onclick="location.reload()" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-bold">ফিরে যান</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // Firebase Configuration (Same as provided)
        const firebaseConfig = {
            apiKey: "AIzaSyC4j1NqdqdYoHlKj_mtX5Kcz_X0M9DhMdI",
            authDomain: "amirul-math-care.firebaseapp.com",
            projectId: "amirul-math-care",
            storageBucket: "amirul-math-care.firebasestorage.app",
            messagingSenderId: "1064654064871",
            appId: "1:1064654064871:web:158df34bedc1d2b528a642",
            databaseURL: "https://amirul-math-care-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Core Listeners
        onValue(ref(db, 'results'), (snap) => {
            const data = snap.val() ? Object.values(snap.val()) : [];
            localStorage.setItem('amc_db_final', JSON.stringify(data));
            if(sessionStorage.getItem('is_admin')) renderResultTable();
        });

        onValue(ref(db, 'students'), (snap) => {
            const data = snap.val() || {};
            localStorage.setItem('amc_student_db', JSON.stringify(data));
            if(sessionStorage.getItem('is_admin')) { loadStudentList(); updateAdminStats(); }
        });

        onValue(ref(db, 'online_questions'), (snap) => {
            const data = snap.val() ? Object.values(snap.val()) : [];
            localStorage.setItem('amc_questions', JSON.stringify(data));
            renderAdminQuestions(snap.val());
        });

        // Global DB Window functions
        window.saveToFB = (path, data) => set(ref(db, path), data);
        window.pushToFB = (path, data) => push(ref(db, path), data);
        window.removeFromFB = (path) => remove(ref(db, path));
    </script>

    <script>
        // --- System Logic & Features ---
        let currentAnswers = {};
        let examQuestions = [];
        let timerInterval;

        const subjectsConfig = {
            "৬ষ্ঠ": ["গণিত", "বিজ্ঞান", "ইংরেজি"],
            "৭ম": ["গণিত", "বিজ্ঞান", "ইংরেজি"],
            "৮ম": ["গণিত", "বিজ্ঞান", "ইংরেজি"],
            "৯ম": ["গণিত", "পদার্থ", "রসায়ন", "উচ্চতর গণিত"],
            "১০ম": ["গণিত", "পদার্থ", "রসায়ন", "উচ্চতর গণিত"],
            "SSC": ["সাধারণ গণিত", "উচ্চতর গণিত", "ICT"]
        };

        // 1. Student Profile Navigation
        function enterStudentProfile() {
            const roll = document.getElementById('searchRoll').value;
            const cls = document.getElementById('searchClass').value;
            if(!roll || !cls) return Swal.fire('Error', 'রোল ও শ্রেণী সিলেক্ট করো!', 'warning');

            const studentDB = JSON.parse(localStorage.getItem('amc_student_db') || "{}");
            const student = studentDB[`${cls}_${roll}`];
            if(!student) return Swal.fire('Error', 'কোন শিক্ষার্থী পাওয়া যায়নি!', 'error');

            document.getElementById('profName').innerText = student.name;
            document.getElementById('profClassRoll').innerText = `শ্রেণী: ${student.cls} | রোল: ${student.roll}`;
            
            // Load Results for Profile
            const allResults = JSON.parse(localStorage.getItem('amc_db_final') || "[]");
            const myResults = allResults.filter(r => r.roll == roll && r.cls == cls).sort((a,b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('totalExams').innerText = myResults.length;
            const list = document.getElementById('profileResultList');
            
            if(myResults.length > 0) {
                let totalScore = 0;
                list.innerHTML = myResults.map(r => {
                    totalScore += Number(r.grandTotal);
                    return `<div class="p-3 bg-gray-50 border rounded-xl flex justify-between items-center">
                        <div><p class="font-bold text-sm">${r.date}</p><p class="text-xs text-gray-500">নম্বর: ${r.grandTotal}</p></div>
                        <span class="text-xs font-bold bg-indigo-100 p-1 px-3 rounded-full">#${getMerit(r.roll, r.cls, r.date)}</span>
                    </div>`;
                }).join('');
                document.getElementById('avgScore').innerText = Math.round(totalScore / myResults.length) + "%";
            } else {
                list.innerHTML = "<p class='text-gray-400 text-sm'>কোন ফলাফল নেই।</p>";
            }

            showSection('studentProfile');
        }

        // 2. Online Exam Logic
        function startExamNow() {
            const name = document.getElementById('exStudentName').value;
            if(!name) return Swal.fire('Error', 'তোমার নাম লিখুন!', 'warning');
            
            examQuestions = JSON.parse(localStorage.getItem('amc_questions') || "[]");
            if(examQuestions.length === 0) return Swal.fire('Oops', 'এখন কোন প্রশ্ন এভেলেবল নেই।', 'info');

            document.getElementById('examStartView').classList.add('hidden');
            document.getElementById('examLiveView').classList.remove('hidden');
            
            renderLiveQuestions();
            startTimer(600); // 10 Minutes
        }

        function renderLiveQuestions() {
            const container = document.getElementById('questionContent');
            container.innerHTML = examQuestions.map((q, i) => `
                <div class="bg-gray-50 p-6 rounded-2xl border shadow-sm">
                    <p class="font-bold text-lg mb-4">${i+1}. ${q.qTitle}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${['a','b','c','d'].map(opt => `
                            <div onclick="selectOpt(${i}, '${opt}')" id="q${i}_${opt}" class="option-card bg-white p-4 rounded-xl text-sm">
                                ${opt.toUpperCase()}. ${q['opt'+opt.toUpperCase()]}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function selectOpt(qIdx, opt) {
            ['a','b','c','d'].forEach(o => document.getElementById(`q${qIdx}_${o}`).classList.remove('selected-option'));
            document.getElementById(`q${qIdx}_${opt}`).classList.add('selected-option');
            currentAnswers[qIdx] = opt;
        }

        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            timerInterval = setInterval(() => {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
                document.getElementById('examTimer').innerText = `<i class="fas fa-clock mr-2"></i> ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (--timer < 0) submitOnlineExam();
            }, 1000);
        }

        function submitOnlineExam() {
            clearInterval(timerInterval);
            let score = 0;
            examQuestions.forEach((q, i) => { if(currentAnswers[i] === q.correctOpt) score++; });

            Swal.fire({
                title: 'পরীক্ষা শেষ!',
                text: `অভিনন্দন! তোমার স্কোর: ${score}/${examQuestions.length}`,
                icon: 'success',
                confirmButtonText: 'ড্যাশবোর্ডে ফিরে যাও'
            }).then(() => location.reload());
        }

        // 3. Admin & Result Logic
        function adminLogin() {
            if(document.getElementById('adminPass').value === "1617798358Ma@1") {
                sessionStorage.setItem('is_admin', 'true');
                showSection('adminPanel');
                document.getElementById('adminLoginBtn').classList.add('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                updateAdminStats();
            } else Swal.fire('Error', 'ভুল পাসওয়ার্ড!', 'error');
        }

        function updateSubjectInputs() {
            const cls = document.getElementById('stdClass').value;
            const container = document.getElementById('subjectInputs');
            if(!subjectsConfig[cls]) return;
            container.innerHTML = subjectsConfig[cls].map(sub => `
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <p class="font-bold text-xs mb-2 text-purple-700">${sub}</p>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="mcq_${sub}" placeholder="MCQ" class="p-2 border rounded text-xs">
                        <input type="number" id="cq_${sub}" placeholder="CQ" class="p-2 border rounded text-xs">
                    </div>
                </div>
            `).join('');
        }

        function saveResultData() {
            const date = document.getElementById('examDate').value;
            const cls = document.getElementById('stdClass').value;
            const roll = document.getElementById('stdRoll').value;
            const name = document.getElementById('stdName').value;
            if(!date || !cls || !roll) return alert("তথ্য পূরণ করো!");

            let scores = {}, grandTotal = 0;
            subjectsConfig[cls].forEach(sub => {
                const m = Number(document.getElementById(`mcq_${sub}`).value || 0);
                const c = Number(document.getElementById(`cq_${sub}`).value || 0);
                scores[sub] = { m, c, t: m+c };
                grandTotal += (m+c);
            });

            const entry = { date, cls, roll, name, grandTotal, scores, examType: "সাপ্তাহিক" };
            window.pushToFB('results', entry);
            Swal.fire('Saved', 'রেজাল্ট সেভ হয়েছে!', 'success');
            document.getElementById('stdRoll').value = "";
        }

        function saveQuestionToFB() {
            const q = {
                qTitle: document.getElementById('qTitle').value,
                optA: document.getElementById('optA').value,
                optB: document.getElementById('optB').value,
                optC: document.getElementById('optC').value,
                optD: document.getElementById('optD').value,
                correctOpt: document.getElementById('correctOpt').value
            };
            window.pushToFB('online_questions', q);
            Swal.fire('Added', 'প্রশ্ন যুক্ত হয়েছে!', 'success');
        }

        function addStudentToDB() {
            const r = document.getElementById('newRoll').value;
            const n = document.getElementById('newName').value;
            const c = document.getElementById('newClass').value;
            const w = document.getElementById('newWa').value;
            if(!r || !n) return;
            const db = JSON.parse(localStorage.getItem('amc_student_db') || "{}");
            db[`${c}_${r}`] = { roll: r, name: n, cls: c, wa: w };
            window.saveToFB('students', db);
            Swal.fire('Success', 'শিক্ষার্থী যুক্ত হয়েছে', 'success');
        }

        // --- Helper & Utility Functions ---
        function showSection(id) {
            ['studentView', 'studentProfile', 'onlineExamPortal', 'loginSection', 'adminPanel', 'displayArea'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function switchAdminTab(tabId) {
            document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('[id^="btn-"]').forEach(b => {
                b.classList.remove('tab-active'); b.classList.add('text-gray-500');
            });
            document.getElementById('btn-'+tabId).classList.add('tab-active');
        }

        function getMerit(roll, cls, date) {
            let data = JSON.parse(localStorage.getItem('amc_db_final') || "[]").filter(s => s.cls === cls && s.date === date);
            data.sort((a,b) => b.grandTotal - a.grandTotal);
            return data.findIndex(s => s.roll == roll) + 1;
        }

        function fetchStudentInfo() {
            const r = document.getElementById('stdRoll').value;
            const c = document.getElementById('stdClass').value;
            const db = JSON.parse(localStorage.getItem('amc_student_db') || "{}");
            const s = db[`${c}_${r}`];
            document.getElementById('stdName').value = s ? s.name : "";
        }

        function updateAdminStats() {
            const students = JSON.parse(localStorage.getItem('amc_student_db') || "{}");
            const results = JSON.parse(localStorage.getItem('amc_db_final') || "[]");
            document.getElementById('statTotalStudent').innerText = Object.keys(students).length;
            document.getElementById('statTotalResult').innerText = results.length;
        }

        function renderResultTable() {
            let data = JSON.parse(localStorage.getItem('amc_db_final') || "[]");
            const filterDate = document.getElementById('filterDate').value;
            if(filterDate) data = data.filter(r => r.date === filterDate);
            
            document.getElementById('dataTableBody').innerHTML = data.sort((a,b) => b.grandTotal - a.grandTotal).map(r => `
                <tr class="border-b">
                    <td class="p-4 font-bold">${r.roll}</td>
                    <td class="p-4">${r.name}</td>
                    <td class="p-4">${r.cls}</td>
                    <td class="p-4 font-black text-indigo-600">${r.grandTotal}</td>
                    <td class="p-4"><span class="bg-yellow-100 px-2 py-1 rounded">#${getMerit(r.roll, r.cls, r.date)}</span></td>
                    <td class="p-4"><button onclick="deleteResult('${r.date}', '${r.roll}')" class="text-red-500"><i class="fas fa-trash"></i></button></td>
                </tr>`).join('');
        }

        function loadStudentList() {
            const db = JSON.parse(localStorage.getItem('amc_student_db') || "{}");
            document.getElementById('dbList').innerHTML = Object.values(db).map(s => `
                <div class="flex justify-between items-center py-2">
                    <div class="text-sm"><b>[${s.cls}]</b> ${s.roll} - ${s.name}</div>
                    <button class="text-red-400 text-xs"><i class="fas fa-trash"></i></button>
                </div>`).join('');
        }

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
        function logout() { sessionStorage.clear(); location.reload(); }

        window.onload = () => {
            // Hero Slider Initial
            const track = document.getElementById('sliderTrack');
            const images = [
                "https://images.unsplash.com/photo-1518133910546-b6c2fb7d79e3?q=80&w=1000",
                "https://images.unsplash.com/photo-1509062522246-3755977927d7?q=80&w=1000"
            ];
            track.innerHTML = images.map(img => `<div class="slide"><img src="${img}"><div class="absolute inset-0 flex flex-col justify-center items-center text-white p-6"><h2 class="text-4xl font-black mb-2">AMIRUL MATH CARE</h2><p>গণিত হোক আনন্দের মাধ্যম</p></div></div>`).join('');
            
            let idx = 0;
            setInterval(() => {
                idx = (idx + 1) % 2;
                track.style.transform = `translateX(-${idx * 100}%)`;
            }, 5000);
        };
    </script>
</body>
</html>
